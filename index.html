<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Random Page Slideshow</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
        html,
        body {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
            background: #000;
            overflow: hidden;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            cursor: none;
        }

        #container {
            position: fixed;
            inset: 0;
            display: flex;
            flex-direction: column;
            background: #000;
            color: #fff;
        }

        #header {
            padding: 6px 12px;
            font-size: 14px;
            color: #606060aa;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            z-index: 10;
        }

        #status {
            font-size: 12px;
        }

        #controls {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        #page-select {
            font-size: 12px;
            background: #33333369;
            color: #606060aa;
            border: 1px solid #333;
            border-radius: 3px;
            padding: 2px 4px;
        }

        #frame-wrapper {
            flex: 1;
            min-height: 0;
            position: relative;
            overflow: hidden;
        }

        .frame-layer {
            position: absolute;
            inset: 0;
            border: none;
            width: 100%;
            height: 100%;
            background: #000;
            transform: translate(0, 0);
            transition: transform 0.75s ease-in-out;
        }
    </style>
</head>

<body>
    <div id="container">
        <div id="header">
            <div>F0RTHSP4CE VESAGRIND</div>
            <div id="controls">
                <label for="page-select">Page:</label>
                <select id="page-select"></select>
                <div id="status">Loading...</div>
            </div>
        </div>
        <div id="frame-wrapper">
            <iframe class="frame-layer" id="frame-a" src="about:blank"></iframe>
            <iframe class="frame-layer" id="frame-b" src="about:blank"></iframe>
        </div>
    </div>

    <script>
        // EDIT THIS LIST: put your page paths here (relative to this index.html)
        // Example: if your pages live in a folder named "pages", use "pages/whatever.html".
        const PAGES = [
            "pages/f0.html",
            "pages/pong.html",
            "pages/tetris.html",
            "pages/kitty/index.html",
            "pages/cartpole.html",
        ];

        const INTERVAL_MS = 30_000; // 30 seconds

        const frames = Array.from(document.querySelectorAll(".frame-layer"));
        const statusEl = document.getElementById("status");
        const selectEl = document.getElementById("page-select");

        const DIRECTIONS = [
            { name: "left", incomingStart: "translateX(-100%)", outgoingEnd: "translateX(100%)" },
            { name: "right", incomingStart: "translateX(100%)", outgoingEnd: "translateX(-100%)" },
            { name: "up", incomingStart: "translateY(-100%)", outgoingEnd: "translateY(100%)" },
            { name: "down", incomingStart: "translateY(100%)", outgoingEnd: "translateY(-100%)" }
        ];

        function pickRandomIndex(lastIndex, max) {
            if (max <= 1) return 0;
            let idx;
            do {
                idx = Math.floor(Math.random() * max);
            } while (idx === lastIndex);
            return idx;
        }

        let lastIndex = -1;
        let intervalId = null;
        let activeFrameIndex = 0;
        let isTransitioning = false;

        function pickDirection() {
            return DIRECTIONS[Math.floor(Math.random() * DIRECTIONS.length)];
        }

        function updateStatus() {
            if (!PAGES.length) {
                statusEl.textContent = "No pages configured. Edit PAGES in index.html.";
                return;
            }
            const now = new Date();
            statusEl.textContent = `Next change in ${INTERVAL_MS / 1000}s \u00b7 ${now.toLocaleTimeString()}`;
        }

        function immediateShow(frameEl, url) {
            frameEl.style.transition = "none";
            frameEl.style.transform = "translate(0, 0)";
            frameEl.style.zIndex = "2";
            const otherIndex = frames.indexOf(frameEl) === 0 ? 1 : 0;
            const other = frames[otherIndex];
            if (other) {
                other.style.transition = "none";
                other.style.transform = "translate(0, 0)";
                other.style.zIndex = "1";
            }
            frameEl.src = url;
            activeFrameIndex = frames.indexOf(frameEl);
            updateStatus();
        }

        function startSlideTransition(incoming, outgoing, url) {
            if (isTransitioning) return;
            isTransitioning = true;

            const direction = pickDirection();
            statusEl.textContent = `Sliding ${direction.name}...`;

            incoming.style.transition = "none";
            outgoing.style.transition = "none";
            incoming.style.transform = direction.incomingStart;
            outgoing.style.transform = "translate(0, 0)";
            incoming.style.zIndex = "2";
            outgoing.style.zIndex = "1";

            incoming.addEventListener("load", () => {
                requestAnimationFrame(() => {
                    incoming.style.transition = "transform 1s ease-in-out";
                    outgoing.style.transition = "transform 1s ease-in-out";
                    incoming.style.transform = "translate(0, 0)";
                    outgoing.style.transform = direction.outgoingEnd;
                });
            }, { once: true });

            incoming.src = url;

            const finish = () => {
                outgoing.style.transition = "none";
                outgoing.style.transform = "translate(0, 0)";
                outgoing.style.zIndex = "1";
                incoming.style.transition = "none";
                incoming.style.zIndex = "2";
                activeFrameIndex = frames.indexOf(incoming);
                isTransitioning = false;
                updateStatus();
            };

            outgoing.addEventListener("transitionend", finish, { once: true });
            setTimeout(() => {
                if (isTransitioning) finish();
            }, 1200);
        }

        function showPageAtIndex(index) {
            if (!PAGES.length) {
                statusEl.textContent = "No pages configured. Edit PAGES in index.html.";
                frames.forEach((f) => f.src = "about:blank");
                return;
            }

            if (index < 0 || index >= PAGES.length) {
                index = 0;
            }
            const url = PAGES[index];

            if (lastIndex === -1) {
                lastIndex = index;
                immediateShow(frames[activeFrameIndex], url);
            } else {
                lastIndex = index;
                const incomingIndex = activeFrameIndex === 0 ? 1 : 0;
                const incoming = frames[incomingIndex];
                const outgoing = frames[activeFrameIndex];
                startSlideTransition(incoming, outgoing, url);
            }

            if (selectEl) {
                selectEl.value = String(index);
            }
        }

        function showRandomPage() {
            if (!PAGES.length) {
                statusEl.textContent = "No pages configured. Edit PAGES in index.html.";
                frames.forEach((f) => f.src = "about:blank");
                return;
            }

            const nextIndex = pickRandomIndex(lastIndex, PAGES.length);
            showPageAtIndex(nextIndex);
        }

        function restartTimer() {
            if (intervalId !== null) {
                clearInterval(intervalId);
            }
            intervalId = setInterval(showRandomPage, INTERVAL_MS);
        }

        function nextPageNow() {
            showRandomPage();
            restartTimer();
        }

        function populateSelect() {
            if (!selectEl) return;
            selectEl.innerHTML = "";
            PAGES.forEach((url, index) => {
                const option = document.createElement("option");
                option.value = String(index);
                option.textContent = url;
                selectEl.appendChild(option);
            });
        }

        if (selectEl) {
            selectEl.addEventListener("change", () => {
                const index = parseInt(selectEl.value, 10);
                showPageAtIndex(isNaN(index) ? 0 : index);
                restartTimer();
            });
        }

        // Keyboard shortcut: Space or Right Arrow -> next random page
        window.addEventListener("keydown", (event) => {
            // Ignore if focused inside an input/textarea/select (not likely here, but safe)
            const target = event.target;
            const isFormField = target && (target.tagName === "INPUT" || target.tagName === "TEXTAREA" || target.tagName === "SELECT");
            if (isFormField) return;

	    // send enter keypress event
	    if (event.key === 'Enter') {
            frames.forEach(frame => {
                frame.contentWindow.postMessage({
                    type: 'ENTER_PRESSED',
                    value: true,
                }, '*');
            });
	    }

            if (event.code === "Space" || event.key === " " || event.key === "ArrowRight") {
                event.preventDefault();
                nextPageNow();
            }
        });

        // Start the slideshow
        populateSelect();
        showRandomPage();
        restartTimer();
    </script>
</body>

</html>
